<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PhonemeDF Synthetic Dataset</title>
  <!-- Tailwind via CDN for quick styling (no build step) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide icons -->
  <script type="module">
    import { createIcons, Play, Pause, Volume2 } from "https://cdn.jsdelivr.net/npm/lucide@0.469.0/+esm";
    window.addEventListener('DOMContentLoaded', () => createIcons());
  </script>
  <!-- Wavesurfer.js for waveform + regions -->
  <script src="https://unpkg.com/wavesurfer.js@7"></script>
  <script src="https://unpkg.com/wavesurfer.js@7/dist/plugins/regions.min.js"></script>
  <style>
    /* Subtle card shadow */
    .card { box-shadow: 0 10px 20px rgba(0,0,0,0.06); }
    .badge { @apply text-xs px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 border border-slate-200; }
    .pill { @apply text-xs px-2 py-1 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-100; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header -->
  <header class="bg-white sticky top-0 z-50 border-b border-slate-200/60">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 rounded-xl bg-indigo-600"></div>
        <h1 class="text-lg sm:text-xl font-semibold tracking-tight">PhonemeDF Dataset</h1>
      </div>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#references" class="hover:text-indigo-700">Reference Voices</a>
        <a href="#datasets" class="hover:text-indigo-700">Dataset Samples</a>
        <a href="#textgrids" class="hover:text-indigo-700">TextGrid Views</a>
        <a href="#howto" class="hover:text-indigo-700">How to Use</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h2 class="text-3xl font-bold tracking-tight mb-3">Example Audios • Example TextGrids</h2>
        <p class="text-slate-700 leading-relaxed">
          This page shows examples from the <span class="font-semibold">PhonemeDF</span> project: the ten reference voices, per-dataset samples (real & synthetic), and downloadable example 
          <span class="font-semibold">TextGrids</span>.</p>
          <div class="flex flex-wrap gap-2 mt-4" aria-label="Audio and TextGrid Info Badges">
          <span class="badge" title="All audio examples are in 16 kHz mono WAV format">Audios are in 16 kHz wav format</span>
          <span class="badge" title="TextGrids generated using Montreal Forced Aligner (MFA)">TextGrids are from MFA</span>
        </div>
      </div>
      <div class="bg-white p-6 rounded-2xl card">
        <p class="text-sm text-slate-600">Quick links</p>
        <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
          <a class="p-3 rounded-xl border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/40" href="#references">10 Reference Voices</a>
          <a class="p-3 rounded-xl border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/40" href="#datasets">Dataset Samples</a>
          <a class="p-3 rounded-xl border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/40" href="#textgrids">TextGrid Viewer</a>
          <a class="p-3 rounded-xl border border-slate-200 hover:border-indigo-300 hover:bg-indigo-50/40" href="#howto">Cite & Reuse</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Reference Speakers -->
  <section id="references" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex items-end justify-between mb-4">
      <h3 class="text-2xl font-bold">Reference Voices (10)</h3>
      <span class="pill">Reference set</span>
    </div>
    <div id="refGrid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
  </section>

  <!-- Dataset Samples -->
  <section id="datasets" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex items-end justify-between mb-4">
      <h3 class="text-2xl font-bold">Dataset Samples</h3>
      <span class="pill">1–2 samples per set</span>
    </div>
    <div id="dsGrid" class="grid lg:grid-cols-2 gap-4"></div>
  </section>

  <!-- TextGrid Viewer -->
  <section id="textgrids" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex items-end justify-between mb-4">
      <h3 class="text-2xl font-bold">Interactive TextGrid Viewer</h3>
      <span class="pill">Waveform + tiers</span>
    </div>

    <div class="bg-white rounded-2xl card p-4">
      <div class="grid md:grid-cols-5 gap-3 items-end">
        <div class="md:col-span-2">
          <label class="text-sm font-medium">Audio (WAV, 16 kHz)</label>
          <input id="tgAudio" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-indigo-500 focus:border-indigo-500" placeholder="/assets/examples/utt01.wav" />
        </div>
        <div class="md:col-span-2">
          <label class="text-sm font-medium">TextGrid</label>
          <input id="tgFile" type="text" class="mt-1 w-full rounded-xl border-slate-300 focus:ring-indigo-500 focus:border-indigo-500" placeholder="/assets/examples/utt01.TextGrid" />
        </div>
        <button id="tgLoad" class="md:col-span-1 h-10 rounded-xl bg-indigo-600 text-white font-medium hover:bg-indigo-700">Load</button>
      </div>

      <div class="mt-4">
        <div id="wave" class="w-full h-28 rounded-xl overflow-hidden bg-slate-100"></div>
        <div id="tiers" class="mt-4 space-y-2"></div>
      </div>
    </div>
  </section>

  <!-- How to Use / Cite -->
  <section id="howto" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="bg-white rounded-2xl card p-6">
      <h3 class="text-2xl font-bold mb-2">How to Use & Cite</h3>
      <p class="text-slate-700">We will update this once accepted.</p>
      <ul class="list-disc ml-6 mt-3 text-slate-700">
      <!--<p class="text-slate-700">Put your WAV and TextGrid files under <code>/assets/</code> in this repo. Update the metadata below and push—GitHub Pages redeploys automatically. For citation, include a link to this page and the commit hash. You can also add a <code>CITATION.cff</code> file at the repo root.</p>
      <ul class="list-disc ml-6 mt-3 text-slate-700">
        <li><span class="font-medium">Licensing:</span> Add <code>LICENSE</code> clarifying research use.</li>
        <li><span class="font-medium">Provenance:</span> Keep per-file JSON with generator (XTTS/FreeVC/etc.), reference ID, transcript.</li>
        <li><span class="font-medium">Repro:</span> Provide scripts to regenerate examples from source IDs.</li>
      </ul> 
      -->
    </div>
  </section>

  <footer class="py-10 text-center text-slate-500 text-sm">
    © <span id="yr"></span> PhonemeDF Dataset
  </footer>

  <!-- ===================== DATA (edit this) ===================== -->
  <script>
    // Change these paths to match your repo. Suggest storing assets under /assets/... in the same repo.
    const BASE = '/PhonemeDF'; // empty means relative to current site; e.g., '/AudioDF' if needed

    // 10 reference voices (update names/paths). Keep WAV at 16 kHz.
    const referenceVoices = [
      { id: 'ref_p228', name: 'p228 (F)', wav: `${BASE}/assets/ref/p228_023.wav`, note: 'Female reference' },
      { id: 'ref_p243', name: 'p243 (M)', wav: `${BASE}/assets/ref/p243_023.wav`, note: 'Male reference' },
      { id: 'ref_p230', name: 'p230 (F)', wav: `${BASE}/assets/ref/p230_023.wav`, note: 'Female reference' },
      { id: 'ref_p231', name: 'p254 (M)', wav: `${BASE}/assets/ref/p254_023.wav`, note: 'Male reference' },
      { id: 'ref_p240', name: 'p233 (F)', wav: `${BASE}/assets/ref/p233_023.wav`, note: 'Female reference' },
      { id: 'ref_p245', name: 'p258 (M)', wav: `${BASE}/assets/ref/p258_023.wav`, note: 'Male reference' },
      { id: 'ref_p248', name: 'p236 (F)', wav: `${BASE}/assets/ref/p236_023.wav`, note: 'Female reference' },
      { id: 'ref_p251', name: 'p259 (M)', wav: `${BASE}/assets/ref/p259_023.wav`, note: 'Male reference' },
      { id: 'ref_p253', name: 'p244 (F)', wav: `${BASE}/assets/ref/p244_023.wav`, note: 'Female reference' },
      { id: 'ref_p256', name: 'p273 (M)', wav: `${BASE}/assets/ref/p273_023.wav`, note: 'Male reference' },
    ];

    // Datasets: provide 1–2 items each. You can add more.
    // type: 'real' | 'tts' | 'vc'
    const datasetSamples = [
      {
        dataset: 'Train-clean-100', type: 'real', items: [
          { id: 'real_utt01', name: 'Real sample 1', wav: `${BASE}/assets/audio_samples/19-198-0003-Real.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0003-Real.TextGrid` },
          { id: 'real_utt02', name: 'Real sample 2', wav: `${BASE}/assets/audio_samples/19-198-0005-Real.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0005-Real.TextGrid` },
        ]
      },
      {
        dataset: 'Melo TTS', type: 'tts', items: [
          { id: 'melo_01', name: 'Sample 1', wav: `${BASE}/assets/audio_samples/19-198-0003-MeloTTS.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0003-MeloTTS.TextGrid` },
          { id: 'melo_01', name: 'Sample 2', wav: `${BASE}/assets/audio_samples/19-198-0005-MeloTTS.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0005-MeloTTS.TextGrid` }
        ]
      },
      {
        dataset: 'XTTS v2', type: 'tts', items: [
          { id: 'xtts_01', name: 'Sample 1', wav: `${BASE}/assets/audio_samples/19-198-0003-XTTSv2.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0003-XTTSv2.TextGrid` },
          { id: 'xtts_01', name: 'Sample 2', wav: `${BASE}/assets/audio_samples/19-198-0005-XTTSv2.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0005-XTTSv2.TextGrid` }
        ]
      },
      {
        dataset: 'Chatterbox TTS', type: 'tts', items: [
          { id: 'chtts_01', name: 'Sample 1', wav: `${BASE}/assets/audio_samples/19-198-0003-ChTTS.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0003-ChTTS.TextGrid` },
          { id: 'chtts_01', name: 'Sample 2', wav: `${BASE}/assets/audio_samples/19-198-0005-ChTTS.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0005-ChTTS.TextGrid` }
        ]
      },
      {
        dataset: 'VITS', type: 'tts', items: [
          { id: 'vits_01', name: 'Sample 1', wav: `${BASE}/assets/audio_samples/19-198-0003-vitsTTS.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0003-vitsTTS.TextGrid` },
          { id: 'vits_01', name: 'Sample 2', wav: `${BASE}/assets/audio_samples/19-198-0005-vitsTTS.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0005-vitsTTS.TextGrid` }
        ]
      },
      {
        dataset: 'Chatterbox VC', type: 'vc', items: [
          { id: 'chvc_01', name: 'Sample 1', wav: `${BASE}/assets/audio_samples/19-198-0003-ChVC.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0003-ChVC.TextGrid` },
          { id: 'chvc_01', name: 'Sample 2', wav: `${BASE}/assets/audio_samples/19-198-0005-ChVC.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0005-ChVC.TextGrid` }
        ]
      },
      {
        dataset: 'FreeVC', type: 'vc', items: [
          { id: 'freevc_01', name: 'Sample 1', wav: `${BASE}/assets/audio_samples/19-198-0003-FreeVC.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0003-FreeVC.TextGrid` },
          { id: 'freevc_01', name: 'Sample 2', wav: `${BASE}/assets/audio_samples/19-198-0005-FreeVC.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0005-FreeVC.TextGrid` }
        ]
      },
      {
        dataset: 'StarGAN-VC', type: 'vc', items: [
          { id: 'stargan_01', name: 'Sample 1', wav: `${BASE}/assets/audio_samples/19-198-0003-sgVC.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0003-sgVC.TextGrid` },
          { id: 'stargan_01', name: 'Sample 2', wav: `${BASE}/assets/audio_samples/19-198-0005-sgVC.wav`, tg: `${BASE}/assets/textgrid_samples/19-198-0005-sgVC.TextGrid` }
        ]
      },
    ];
  </script>

  <!-- ===================== RENDERERS ===================== -->
  <script>
    const byTypeColor = (t) => ({
      real: 'bg-emerald-50 border-emerald-200',
      tts: 'bg-indigo-50 border-indigo-200',
      vc: 'bg-amber-50 border-amber-200',
    })[t] || 'bg-slate-50 border-slate-200';

    function audioCard({ title, subtitle, wav, chips = [] }) {
      return `
        <div class="bg-white rounded-2xl card p-4 border border-slate-200">
          <div class="flex items-center justify-between">
            <div>
              <h4 class="font-semibold">${title}</h4>
              <p class="text-sm text-slate-600">${subtitle || ''}</p>
            </div>
          </div>
          <audio controls class="mt-3 w-full" preload="none">
            <source src="${wav}" type="audio/wav" />
            Your browser does not support the audio element.
          </audio>
          <div class="mt-3 flex flex-wrap gap-2">${chips.map(c => `<span class="badge">${c}</span>`).join('')}</div>
        </div>`;
    }

    function datasetCard(ds) {
      const color = byTypeColor(ds.type);
      const items = ds.items.map(it => `
        <div class="bg-white rounded-xl p-3 border border-slate-200">
          <div class="flex items-center justify-between">
            <div>
              <h5 class="font-medium">${it.name}</h5>
              <p class="text-xs text-slate-600 mt-0.5">${it.text || ''}</p>
            </div>
            <span class="pill">${ds.dataset}</span>
          </div>
          <audio controls class="mt-2 w-full" preload="none">
            <source src="${it.wav}" type="audio/wav" />
          </audio>
          <div class="mt-2 flex items-center gap-2 text-sm">
            <a class="underline text-indigo-700" href="${it.tg}" target="_blank">TextGrid</a>
            <button class="text-indigo-700 underline" onclick="loadIntoViewer('${it.wav}','${it.tg}')">Open in viewer</button>
          </div>
        </div>
      `).join('');

      return `
        <div class="rounded-2xl card p-4 border ${color}">
          <div class="flex items-center justify-between mb-2">
            <h4 class="font-semibold">${ds.dataset}</h4>
            <span class="badge">${ds.type.toUpperCase()}</span>
          </div>
          <div class="grid gap-3">${items}</div>
        </div>`;
    }

    function renderAll() {
      document.getElementById('yr').textContent = new Date().getFullYear();

      // Render references
      const refGrid = document.getElementById('refGrid');
      refGrid.innerHTML = referenceVoices.map(r => audioCard({
        title: r.name,
        subtitle: r.note,
        wav: r.wav,
        //chips: ['Reference', '16 kHz']
      })).join('');

      // Render datasets
      const dsGrid = document.getElementById('dsGrid');
      dsGrid.innerHTML = datasetSamples.map(datasetCard).join('');
    }

    document.addEventListener('DOMContentLoaded', renderAll);
  </script>

  <!-- ===================== TEXTGRID PARSER + VIEWER ===================== -->
  <script>
    // Minimal TextGrid parser (works for Praat ASCII TextGrid files)
    async function fetchText(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Failed to fetch ${url}`);
      return await res.text();
    }

    function parseTextGrid(txt) {
      // Very lightweight parser for IntervalTiers: name, xmin, xmax, intervals [xmin,xmax,text]
      const lines = txt.split(/\r?\n/);
      const tiers = [];
      let i = 0;
      while (i < lines.length) {
        const line = lines[i].trim();
        if (line.startsWith('class = "IntervalTier"')) {
          // Find name, xmin, xmax
          let name = 'Tier';
          let xmin = 0, xmax = 0;
          // Next lines contain name, xmin, xmax in any order
          for (let k = 1; k <= 6 && i + k < lines.length; k++) {
            const s = lines[i + k].trim();
            if (s.startsWith('name =')) name = s.split('=')[1].trim().replace(/^"|"$/g, '');
            if (s.startsWith('xmin =')) xmin = parseFloat(s.split('=')[1]);
            if (s.startsWith('xmax =')) xmax = parseFloat(s.split('=')[1]);
            if (s.startsWith('intervals: size =')) { i = i + k; break; }
          }
          // intervals
          const sizeLine = lines[i].trim();
          const size = parseInt(sizeLine.split('=')[1]);
          const intervals = [];
          for (let n = 0; n < size; n++) {
            // Expect lines like: intervals [n]:, xmin = x, xmax = y, text = "..."
            // Advance until 'xmin' found
            while (++i < lines.length && !lines[i].includes('xmin =')) {}
            const xminV = parseFloat(lines[i].split('=')[1]);
            while (++i < lines.length && !lines[i].includes('xmax =')) {}
            const xmaxV = parseFloat(lines[i].split('=')[1]);
            while (++i < lines.length && !lines[i].includes('text =')) {}
            const textV = lines[i].split('=')[1].trim().replace(/^"|"$/g, '');
            intervals.push({ xmin: xminV, xmax: xmaxV, text: textV });
          }
          tiers.push({ name, xmin, xmax, intervals });
        }
        i++;
      }
      return tiers;
    }

    let ws;
    async function loadIntoViewer(audioUrl, tgUrl) {
      document.getElementById('tgAudio').value = audioUrl;
      document.getElementById('tgFile').value = tgUrl;
      await createWave(audioUrl);
      await addTextGrid(tgUrl);
    }

    async function createWave(audioUrl) {
      // Cleanup previous
      if (ws) { ws.destroy(); }
      ws = WaveSurfer.create({
        container: '#wave',
        height: 100,
        waveColor: '#94a3b8',
        progressColor: '#4f46e5',
        cursorColor: '#111827',
        url: audioUrl,
      });
      // Add regions plugin (for tiers/intervals)
      ws.regions = ws.registerPlugin(Regions.create());
      return new Promise(resolve => ws.on('ready', resolve));
    }

    function colorForTier(name) {
      // Simple hashing into a pastel color
      let h = 0; for (let i = 0; i < name.length; i++) h = (h * 31 + name.charCodeAt(i)) % 360;
      return `hsla(${h}, 80%, 80%, 0.4)`;
    }

    async function addTextGrid(url) {
      const text = await fetchText(url);
      const tiers = parseTextGrid(text);
      // Clear previous regions
      ws.regions.getRegions().forEach(r => r.remove());
      const T = document.getElementById('tiers');
      T.innerHTML = '';

      tiers.forEach((tier, idx) => {
        // Controls row per tier
        const row = document.createElement('div');
        row.className = 'flex items-center gap-2';
        const label = document.createElement('span');
        label.className = 'text-sm font-medium text-slate-700 w-24';
        label.textContent = tier.name;
        row.appendChild(label);
        const chips = document.createElement('div');
        chips.className = 'flex flex-wrap gap-1';
        row.appendChild(chips);
        T.appendChild(row);

        const color = colorForTier(tier.name);
        tier.intervals.forEach(iv => {
          if (isFinite(iv.xmin) && isFinite(iv.xmax) && iv.xmax > iv.xmin) {
            ws.regions.addRegion({ start: iv.xmin, end: iv.xmax, content: iv.text || '', color, drag: false, resize: false });
            // Tiny chips list for quick scan
            const c = document.createElement('span');
            c.className = 'badge';
            c.textContent = iv.text || '∅';
            chips.appendChild(c);
          }
        });
      });
    }

    document.getElementById('tgLoad').addEventListener('click', async () => {
      const a = document.getElementById('tgAudio').value.trim();
      const t = document.getElementById('tgFile').value.trim();
      if (!a || !t) return alert('Please provide both audio and TextGrid paths.');
      await createWave(a);
      await addTextGrid(t);
    });
  </script>
</body>
</html>
